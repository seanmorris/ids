#!/bin/bash

set -eu;

while read -d $'\0' VAR ; do declare "$VAR"; done < <(make env);

[[ "$TARGET" == "test" ]] && set +x;


while read LINE; do echo $LINE | {
	echo "$BRANCH:$TARGET found in .publishing file. Ids is building & pushing now.";

	IFS=":" read _BRANCH TARGET

	make TARGET=$TARGET;
	make TARGET=$TARGET push-images;

}; done < .publishing;
